"use strict";
//#region "Imports"
///<reference types="../FUDGE/Core/Build/FudgeCore.js"/>
///<reference types="../FUDGE/Aid/Build/FudgeAid.js"/>
//#endregion "Imports"
var Game;
//#region "Imports"
///<reference types="../FUDGE/Core/Build/FudgeCore.js"/>
///<reference types="../FUDGE/Aid/Build/FudgeAid.js"/>
//#endregion "Imports"
(function (Game) {
    Game.ƒ = FudgeCore;
    Game.ƒAid = FudgeAid;
    //#region "DomElements"
    Game.canvas = document.getElementById("Canvas");
    window.addEventListener("load", init);
    //#endregion "DomElements"
    //#region "PublicVariables"
    Game.viewport = new Game.ƒ.Viewport();
    Game.graph = new Game.ƒ.Node("Graph");
    //#endregion "PublicVariables"
    //#region "PrivateVariables"
    let cmpCamera = new Game.ƒ.ComponentCamera();
    //#endregion "PrivateVariables"
    //#region "essential"
    function init() {
        cmpCamera.mtxPivot.translateZ(15);
        cmpCamera.mtxPivot.rotateX(180);
        cmpCamera.mtxPivot.lookAt(Game.ƒ.Vector3.ZERO(), Game.ƒ.Vector3.Y());
        Game.graph.addChild(new Game.ƒAid.Node("blob", Game.ƒ.Matrix4x4.IDENTITY(), new Game.ƒ.Material("mtrCharacter", Game.ƒ.ShaderFlat, new Game.ƒ.CoatColored(Game.ƒ.Color.CSS("withe", 0))), new Game.ƒ.MeshCube()));
        Game.graph.getChildren()[0].mtxLocal.scale(new Game.ƒ.Vector3(1, 1, 1));
        console.log(Game.graph.getChildren()[0].name);
        Game.viewport.initialize("Viewport", Game.graph, cmpCamera, Game.canvas);
        draw();
    }
    function draw() {
        Game.viewport.draw();
    }
    function update() {
        draw();
    }
    Game.ƒ.Loop.addEventListener("loopFrame" /* LOOP_FRAME */, update);
    Game.ƒ.Loop.start(Game.ƒ.LOOP_MODE.TIME_GAME, 69);
    //#endregion "essential"
})(Game || (Game = {}));
var InputSystem;
(function (InputSystem) {
    Game.canvas.addEventListener("keypress", move);
    Game.canvas.addEventListener("mousedown", attack);
    function move(_e) {
        let key = _e.code.toUpperCase();
        let moveVector = new Game.ƒ.Vector2();
        switch (key) {
            case "W":
                moveVector.y += 1;
                break;
            case "A":
                moveVector.x -= 1;
                break;
            case "S":
                moveVector.y -= 1;
                break;
            case "D":
                moveVector.x += 1;
                break;
            default:
                break;
        }
        // player.move
    }
    function attack(e_) {
        let mouseButton = e_.button;
        switch (mouseButton) {
            case 0:
                //TODO: left mouse button player.attack
                break;
            case 2:
                //TODO: right mouse button player.charge or something like that
                break;
            default:
                break;
        }
    }
})(InputSystem || (InputSystem = {}));
var Level;
(function (Level) {
    class Landscape extends ƒ.Node {
        constructor(_name) {
            super(_name);
            // this.getChildren()[0].getComponent(Game.ƒ.ComponentTransform).mtxLocal.translateZ(-2)
            console.log();
        }
    }
    Level.Landscape = Landscape;
})(Level || (Level = {}));
///<reference path="../FUDGE/Net/Build/Client/FudgeClient.d.ts"/>
///<reference path="../FUDGE/Net/Build/Server/FudgeServer.d.ts"/>
var Networking;
///<reference path="../FUDGE/Net/Build/Client/FudgeClient.d.ts"/>
///<reference path="../FUDGE/Net/Build/Server/FudgeServer.d.ts"/>
(function (Networking) {
    var ƒClient = FudgeNet.FudgeClient;
    // import ƒServer = FudgeServer;
    let portHost = document.getElementById("PortHost");
    document.getElementById("Host").addEventListener("click", hostServer, true);
    let IPConnection = document.getElementById("IPConnection");
    let PortConnection = document.getElementById("PortConnection");
    document.getElementById("Connecting").addEventListener("click", conneting, true);
    function hostServer() {
        if (!isNaN(+portHost.value)) {
            //TODO: learn FudgeNet
            // let host = new FudgeServer();
            // host.startUp(+portHost.value);
            // console.log(host);
        }
        else {
            alert("Your Port is not a number");
        }
    }
    function conneting() {
        let client = new ƒClient();
        client.connectToServer(IPConnection.value + PortConnection.value);
        console.log(+IPConnection.value);
        console.log(IPConnection.value + PortConnection.value);
    }
})(Networking || (Networking = {}));
var Player;
(function (Player_1) {
    class Player {
        constructor() {
        }
        move() {
        }
        attack() {
        }
    }
    Player_1.Player = Player;
})(Player || (Player = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL0NsYXNzZXMvTWFpbi50cyIsIi4uL0NsYXNzZXMvRW5lbXkudHMiLCIuLi9DbGFzc2VzL0lucHV0U3lzdGVtLnRzIiwiLi4vQ2xhc3Nlcy9JdGVtcy50cyIsIi4uL0NsYXNzZXMvTGFuZHNjYXBlLnRzIiwiLi4vQ2xhc3Nlcy9OZXR3b3JraW5nLnRzIiwiLi4vQ2xhc3Nlcy9QbGF5ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLG1CQUFtQjtBQUNuQix3REFBd0Q7QUFDeEQsc0RBQXNEO0FBQ3RELHNCQUFzQjtBQUV0QixJQUFVLElBQUksQ0FnRGI7QUFyREQsbUJBQW1CO0FBQ25CLHdEQUF3RDtBQUN4RCxzREFBc0Q7QUFDdEQsc0JBQXNCO0FBRXRCLFdBQVUsSUFBSTtJQUNJLE1BQUMsR0FBRyxTQUFTLENBQUM7SUFDZCxTQUFJLEdBQUcsUUFBUSxDQUFDO0lBRTlCLHVCQUF1QjtJQUNaLFdBQU0sR0FBeUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM1RixNQUFNLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RDLDBCQUEwQjtJQUUxQiwyQkFBMkI7SUFDaEIsYUFBUSxHQUFlLElBQUksS0FBQSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDeEMsVUFBSyxHQUFXLElBQUksS0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQy9DLDhCQUE4QjtJQUU5Qiw0QkFBNEI7SUFDNUIsSUFBSSxTQUFTLEdBQXNCLElBQUksS0FBQSxDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDM0QsK0JBQStCO0lBRS9CLHFCQUFxQjtJQUNyQixTQUFTLElBQUk7UUFDVCxTQUFTLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVsQyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVoQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsS0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFM0QsS0FBQSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksS0FBQSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFBLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsSUFBSSxLQUFBLENBQUMsQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLEtBQUEsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLEtBQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxLQUFBLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFMUssS0FBQSxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFFN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFBLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUV6QyxLQUFBLFFBQVEsQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLEtBQUEsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFBLE1BQU0sQ0FBQyxDQUFDO1FBRTFELElBQUksRUFBRSxDQUFDO0lBQ1gsQ0FBQztJQUVELFNBQVMsSUFBSTtRQUNULEtBQUEsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxTQUFTLE1BQU07UUFDWCxJQUFJLEVBQUUs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QUFDO0lBRWpGLFNBQVMsVUFBVTtRQUNmLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFFekIsc0JBQXNCO1lBQ3RCLGdDQUFnQztZQUdoQyxpQ0FBaUM7WUFFakMscUJBQXFCO1NBQ3hCO2FBQU07WUFDSCxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztTQUN0QztJQUNMLENBQUM7SUFFRCxTQUFTLFNBQVM7UUFDZCxJQUFJLE1BQU0sR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzNCLE1BQU0sQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLEtBQUssR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFbEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxLQUFLLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzNELENBQUM7QUFDTCxDQUFDLEVBaENTLFVBQVUsS0FBVixVQUFVLFFBZ0NuQjtBQ25DRCxJQUFVLE1BQU0sQ0FlZjtBQWZELFdBQVUsUUFBTTtJQUVaLE1BQWEsTUFBTTtRQUNmO1FBRUEsQ0FBQztRQUVNLElBQUk7UUFFWCxDQUFDO1FBRU0sTUFBTTtRQUViLENBQUM7S0FDSjtJQVpZLGVBQU0sU0FZbEIsQ0FBQTtBQUNMLENBQUMsRUFmUyxNQUFNLEtBQU4sTUFBTSxRQWVmIiwic291cmNlc0NvbnRlbnQiOlsiLy8jcmVnaW9uIFwiSW1wb3J0c1wiXHJcbi8vLzxyZWZlcmVuY2UgdHlwZXM9XCIuLi9GVURHRS9Db3JlL0J1aWxkL0Z1ZGdlQ29yZS5qc1wiLz5cclxuLy8vPHJlZmVyZW5jZSB0eXBlcz1cIi4uL0ZVREdFL0FpZC9CdWlsZC9GdWRnZUFpZC5qc1wiLz5cclxuLy8jZW5kcmVnaW9uIFwiSW1wb3J0c1wiXHJcblxyXG5uYW1lc3BhY2UgR2FtZSB7XHJcbiAgICBleHBvcnQgaW1wb3J0IMaSID0gRnVkZ2VDb3JlO1xyXG4gICAgZXhwb3J0IGltcG9ydCDGkkFpZCA9IEZ1ZGdlQWlkO1xyXG5cclxuICAgIC8vI3JlZ2lvbiBcIkRvbUVsZW1lbnRzXCJcclxuICAgIGV4cG9ydCBsZXQgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IDxIVE1MQ2FudmFzRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIkNhbnZhc1wiKTsgICBcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBpbml0KTtcclxuICAgIC8vI2VuZHJlZ2lvbiBcIkRvbUVsZW1lbnRzXCJcclxuXHJcbiAgICAvLyNyZWdpb24gXCJQdWJsaWNWYXJpYWJsZXNcIlxyXG4gICAgZXhwb3J0IGxldCB2aWV3cG9ydDogxpIuVmlld3BvcnQgPSBuZXcgxpIuVmlld3BvcnQoKTtcclxuICAgIGV4cG9ydCBsZXQgZ3JhcGg6IMaSLk5vZGUgPSBuZXcgxpIuTm9kZShcIkdyYXBoXCIpO1xyXG4gICAgLy8jZW5kcmVnaW9uIFwiUHVibGljVmFyaWFibGVzXCJcclxuXHJcbiAgICAvLyNyZWdpb24gXCJQcml2YXRlVmFyaWFibGVzXCJcclxuICAgIGxldCBjbXBDYW1lcmE6IMaSLkNvbXBvbmVudENhbWVyYSA9IG5ldyDGki5Db21wb25lbnRDYW1lcmEoKTtcclxuICAgIC8vI2VuZHJlZ2lvbiBcIlByaXZhdGVWYXJpYWJsZXNcIlxyXG5cclxuICAgIC8vI3JlZ2lvbiBcImVzc2VudGlhbFwiXHJcbiAgICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICAgIGNtcENhbWVyYS5tdHhQaXZvdC50cmFuc2xhdGVaKDE1KTtcclxuXHJcbiAgICAgICAgY21wQ2FtZXJhLm10eFBpdm90LnJvdGF0ZVgoMTgwKTtcclxuXHJcbiAgICAgICAgY21wQ2FtZXJhLm10eFBpdm90Lmxvb2tBdCjGki5WZWN0b3IzLlpFUk8oKSwgxpIuVmVjdG9yMy5ZKCkpO1xyXG5cclxuICAgICAgICBncmFwaC5hZGRDaGlsZChuZXcgxpJBaWQuTm9kZShcImJsb2JcIiwgxpIuTWF0cml4NHg0LklERU5USVRZKCksIG5ldyDGki5NYXRlcmlhbChcIm10ckNoYXJhY3RlclwiLCDGki5TaGFkZXJGbGF0LCBuZXcgxpIuQ29hdENvbG9yZWQoxpIuQ29sb3IuQ1NTKFwid2l0aGVcIiwgMCkpKSwgbmV3IMaSLk1lc2hDdWJlKCkpKTtcclxuICAgICAgICBcclxuICAgICAgICBncmFwaC5nZXRDaGlsZHJlbigpWzBdLm10eExvY2FsLnNjYWxlKG5ldyDGki5WZWN0b3IzKDEsIDEsIDEpKVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhncmFwaC5nZXRDaGlsZHJlbigpWzBdLm5hbWUpO1xyXG5cclxuICAgICAgICB2aWV3cG9ydC5pbml0aWFsaXplKFwiVmlld3BvcnRcIiwgZ3JhcGgsIGNtcENhbWVyYSwgY2FudmFzKTtcclxuXHJcbiAgICAgICAgZHJhdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYXcoKTogdm9pZCB7XHJcbiAgICAgICAgdmlld3BvcnQuZHJhdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcclxuICAgICAgICBkcmF3KCk7XHJcbiAgICB9XHJcblxyXG4gICAgxpIuTG9vcC5hZGRFdmVudExpc3RlbmVyKMaSLkVWRU5ULkxPT1BfRlJBTUUsIHVwZGF0ZSk7XHJcbiAgICDGki5Mb29wLnN0YXJ0KMaSLkxPT1BfTU9ERS5USU1FX0dBTUUsIDY5KTtcclxuICAgIC8vI2VuZHJlZ2lvbiBcImVzc2VudGlhbFwiXHJcbn0iLCJuYW1lc3BhY2UgRW5lbXkgeyBcclxuICAgIFxyXG59IiwibmFtZXNwYWNlIElucHV0U3lzdGVtIHtcclxuXHJcbiAgICBHYW1lLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwia2V5cHJlc3NcIiwgbW92ZSk7XHJcbiAgICBHYW1lLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGF0dGFjayk7XHJcblxyXG4gICAgZnVuY3Rpb24gbW92ZShfZTogS2V5Ym9hcmRFdmVudCkge1xyXG5cclxuICAgICAgICBsZXQga2V5OiBzdHJpbmcgPSBfZS5jb2RlLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgbGV0IG1vdmVWZWN0b3I6IEdhbWUuxpIuVmVjdG9yMiA9IG5ldyBHYW1lLsaSLlZlY3RvcjIoKTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChrZXkpIHtcclxuICAgICAgICAgICAgY2FzZSBcIldcIjpcclxuICAgICAgICAgICAgICAgIG1vdmVWZWN0b3IueSArPSAxO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIFwiQVwiOlxyXG4gICAgICAgICAgICAgICAgbW92ZVZlY3Rvci54IC09IDE7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgXCJTXCI6XHJcbiAgICAgICAgICAgICAgICBtb3ZlVmVjdG9yLnkgLT0gMTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSBcIkRcIjpcclxuICAgICAgICAgICAgICAgIG1vdmVWZWN0b3IueCArPSAxO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBwbGF5ZXIubW92ZVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGF0dGFjayhlXzogTW91c2VFdmVudCkge1xyXG5cclxuICAgICAgICBsZXQgbW91c2VCdXR0b24gPSBlXy5idXR0b247XHJcblxyXG4gICAgICAgIHN3aXRjaCAobW91c2VCdXR0b24pIHtcclxuICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgLy9UT0RPOiBsZWZ0IG1vdXNlIGJ1dHRvbiBwbGF5ZXIuYXR0YWNrXHJcblxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgIC8vVE9ETzogcmlnaHQgbW91c2UgYnV0dG9uIHBsYXllci5jaGFyZ2Ugb3Igc29tZXRoaW5nIGxpa2UgdGhhdFxyXG5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iLCJuYW1lc3BhY2UgSXRlbXMge1xyXG4gICAgXHJcbn0iLCJuYW1lc3BhY2UgTGV2ZWwge1xyXG5cclxuICAgIGV4cG9ydCBjbGFzcyBMYW5kc2NhcGUgZXh0ZW5kcyDGki5Ob2Rle1xyXG4gICAgICAgIGNvbnN0cnVjdG9yKF9uYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgc3VwZXIoX25hbWUpO1xyXG5cclxuICAgICAgICAgICAgLy8gdGhpcy5nZXRDaGlsZHJlbigpWzBdLmdldENvbXBvbmVudChHYW1lLsaSLkNvbXBvbmVudFRyYW5zZm9ybSkubXR4TG9jYWwudHJhbnNsYXRlWigtMilcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSIsIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL0ZVREdFL05ldC9CdWlsZC9DbGllbnQvRnVkZ2VDbGllbnQuZC50c1wiLz5cclxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vRlVER0UvTmV0L0J1aWxkL1NlcnZlci9GdWRnZVNlcnZlci5kLnRzXCIvPlxyXG5cclxubmFtZXNwYWNlIE5ldHdvcmtpbmcge1xyXG4gICAgaW1wb3J0IMaSQ2xpZW50ID0gRnVkZ2VOZXQuRnVkZ2VDbGllbnQ7XHJcbiAgICAvLyBpbXBvcnQgxpJTZXJ2ZXIgPSBGdWRnZVNlcnZlcjtcclxuXHJcbiAgICBsZXQgcG9ydEhvc3QgPSA8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIlBvcnRIb3N0XCIpO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJIb3N0XCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBob3N0U2VydmVyLCB0cnVlKTtcclxuICAgIGxldCBJUENvbm5lY3Rpb24gPSA8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIklQQ29ubmVjdGlvblwiKTtcclxuICAgIGxldCBQb3J0Q29ubmVjdGlvbiA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiUG9ydENvbm5lY3Rpb25cIik7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIkNvbm5lY3RpbmdcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNvbm5ldGluZywgdHJ1ZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gaG9zdFNlcnZlcigpIHtcclxuICAgICAgICBpZiAoIWlzTmFOKCtwb3J0SG9zdC52YWx1ZSkpIHtcclxuXHJcbiAgICAgICAgICAgIC8vVE9ETzogbGVhcm4gRnVkZ2VOZXRcclxuICAgICAgICAgICAgLy8gbGV0IGhvc3QgPSBuZXcgRnVkZ2VTZXJ2ZXIoKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvLyBob3N0LnN0YXJ0VXAoK3BvcnRIb3N0LnZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGhvc3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGFsZXJ0KFwiWW91ciBQb3J0IGlzIG5vdCBhIG51bWJlclwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY29ubmV0aW5nKCkge1xyXG4gICAgICAgIGxldCBjbGllbnQgPSBuZXcgxpJDbGllbnQoKTtcclxuICAgICAgICBjbGllbnQuY29ubmVjdFRvU2VydmVyKElQQ29ubmVjdGlvbi52YWx1ZSArIFBvcnRDb25uZWN0aW9uLnZhbHVlKTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coK0lQQ29ubmVjdGlvbi52YWx1ZSlcclxuICAgICAgICBjb25zb2xlLmxvZyhJUENvbm5lY3Rpb24udmFsdWUgKyBQb3J0Q29ubmVjdGlvbi52YWx1ZSk7XHJcbiAgICB9XHJcbn0iLCJuYW1lc3BhY2UgUGxheWVyIHtcclxuXHJcbiAgICBleHBvcnQgY2xhc3MgUGxheWVyIHtcclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgbW92ZSgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYXR0YWNrKCkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=